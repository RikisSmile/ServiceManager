<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Process Control and Monitor</title>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #000000;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        /* ... (rest of CSS styles) ... */
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: #007bff;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #007bff;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .status-ok {
            color: #28a745;
            font-weight: bold;
        }
        .status-error {
            color: #dc3545;
            font-weight: bold;
        }
        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        .start-btn {
            background-color: #007bff;
            color: white;
        }
        .start-btn:hover {
            background-color: #0056b3;
        }
        .end-btn {
            background-color: #dc3545;
            color: white;
        }
        .end-btn:hover {
            background-color: #a71d2a;
        }
        #refresh-button {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        #refresh-button:hover {
            background-color: #218838;
        }
        .last-updated {
            text-align: right;
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Server Processes Control Panel ðŸš€</h1>
        
        <div id="data-container">
            <p>Loading process data...</p>
        </div>
        
        <button id="refresh-button">Refresh Data</button>
        <p class="last-updated">Last Updated: <span id="timestamp"></span></p>
    </div>

    <script>
        // --- Configuration ---
        // !!! REPLACE 192.168.1.89 WITH YOUR ACTUAL API SERVER IP !!!
        const API_SERVER_BASE = 'http://192.168.1.89:6755'; 

        const PROCESS_LIST_URL = `${API_SERVER_BASE}/process/list`;
        const CONTROL_URL = `${API_SERVER_BASE}/process/control`;
        
        // --- DOM Elements ---
        const dataContainer = document.getElementById('data-container');
        const refreshButton = document.getElementById('refresh-button');
        const timestampSpan = document.getElementById('timestamp');

        // --- Control Function (POST) ---
        async function controlProcess(fn, id) {
            console.log(`Attempting to send command: ${fn} for ID: ${id}`);
            
            const formData = new URLSearchParams();
            formData.append('fn', fn);
            formData.append('id', id);

            try {
                const response = await fetch(CONTROL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded' 
                    },
                    body: formData.toString()
                });

                if (!response.ok) {
                    throw new Error(`Control Server returned HTTP status: ${response.status}`);
                }

                const result = await response.text(); 
                alert(`Command '${fn}' for ID ${id} sent successfully.`);
                
            } catch (error) {
                console.error('Control request error:', error);
                alert(`ðŸ”´ ERROR sending command: ${error.message}.`);
            }
            fetchProcessData(); 
        }

        // --- Data Fetching Function (GET) ---
        async function fetchProcessData() {
            dataContainer.innerHTML = '<p>Loading process data...</p>'; 
            
            try {
                const response = await fetch(PROCESS_LIST_URL);
                
                if (!response.ok) {
                    throw new Error(`Server returned HTTP status: ${response.status}`);
                }
                
                const processes = await response.json();
                
                renderTable(processes);
                timestampSpan.textContent = new Date().toLocaleTimeString();
                
            } catch (error) {
                console.error('Fetch error:', error);
                dataContainer.innerHTML = `
                    <p class="status-error">ðŸ”´ Could not connect to API Server (${API_SERVER_BASE}).</p>
                    <p>Details: ${error.message}</p>
                `;
                timestampSpan.textContent = 'Failed to load';
            }
        }

        // --- Rendering Function ---
        function renderTable(processes) {
            if (!Array.isArray(processes) || processes.length === 0) {
                dataContainer.innerHTML = '<p>No process data received.</p>';
                return;
            }

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            processes.forEach((process, index) => { 
                const statusText = process.status ? process.status.toLowerCase() : 'unknown';
                const statusClass = statusText === 'ok' || statusText === 'running' 
                                    ? 'status-ok' 
                                    : 'status-error';

                const actionButtons = `
                    <button onclick="controlProcess('start', ${index})" class="action-btn start-btn">Start</button>
                    <button onclick="controlProcess('end', ${index})" class="action-btn end-btn">End</button>
                `;

                tableHTML += `
                    <tr>
                        <td>${index}</td> 
                        <td>${process.desc || 'N/A'}</td>
                        <td class="${statusClass}">${process.status || 'UNKNOWN'}</td>
                        <td>${actionButtons}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            dataContainer.innerHTML = tableHTML;
        }

        // --- Initialization ---
        refreshButton.addEventListener('click', fetchProcessData);
        fetchProcessData();
        setInterval(fetchProcessData, 60000);
    </script>
</body>
</html>